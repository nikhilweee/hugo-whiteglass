<!-- Dark Mode -->
<script type="text/javascript">

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
        changeGiscusTheme();
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
            changeGiscusTheme();
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
            changeGiscusTheme();
        }
    })

    async function changeGiscusTheme() {
        let theme = localStorage.getItem("pref-theme");
        let message = { setConfig: { theme: theme } };
        let iframe = document.querySelector('iframe.giscus-frame');
        let tries = 0
        while (!iframe && tries < 10) {
            tries += 1;
            // sleep for 500ms. try max 10 times.
            // console.log('waiting for disqus ...')
            await new Promise(r => setTimeout(r, 500));
            iframe = document.querySelector('iframe.giscus-frame');
        }
        if (iframe) {
            iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
    }

</script>

{{ if .Site.GoogleAnalytics }}
    {{ template "_internal/google_analytics.html" . }}
{{ end }}

{{ if and (eq .Section "blog") (.IsPage) (ne .Params.comments false) }}
    <script src="https://giscus.app/client.js" data-repo="nikhilweee/nikhilweee.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzOTU5NjUwNTc=" data-category="Comments" data-category-id="DIC_kwDOF5nygc4COpdc"
        data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top"
        data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async>
    </script>
{{ end }}